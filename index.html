<!doctype html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <link rel="stylesheet" href="style.css">
    <link rel="manifest" href="manifest.json" />
    <meta name="viewport"
          content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>хера чё я умею не зря пары прогуливал</title>
</head>
<body>
    <div id="main">
        <a id="ras" class="sliding-button">Расписание</a>
        <a id="lec" href="https://drive.google.com/drive/folders/1kTotTTT2Nc5Uucr0dU3sCeF3lzgUTGky" class="sliding-button">Лекции</a>
        <a id="zwon" class="sliding-button">Расписание звонков</a>
    </div>
    <p id="weekType"></p>
    <div id ="ras1">
        <table>
        <tr>
          <th>№</th>
          <th>Понедельник</th>
          <th>Вторник</th>
          <th>Среда</th>
          <th>Четверг</th>
          <th>Пятница</th>
          <th>Суббота</th>
          </tr>
         <tr>
          <td>1</td>
          <td>МДК 02.03<br>
              Басова 403</td>
          <td>Физ-ра<br>
              Янгутов<br></td>
          <td>-</td>
          <td>МДК 03.01<br>
              Таланов</td>
          <td>Психология общ.<br>
              Суменкова</td>
          <td>ПОПД<br>
              Сергеев 205</td>
         </tr>
        <tr>
          <td>2</td>
          <td>МДК 10.02<br>
          Типцова 404</td>
          <td>Основы философии<br>
          Сергеев 205</td>
          <td>Теория вероятности<br>
          Вергазов 304</td>
          <td>МДК 05.03<br>
          Иванова 301</td>
          <td>МДК 12.01<br>
          Таланов</td>
          <td>МДК 05.02<br>
          Иванова 301</td>
        </tr>
        <tr>
          <td>3</td>
          <td>Ин Яз<br>
          Тюгаева 402<br>Земскова 302</td>
          <td>МДК 02.02<br>
          Иванова 301</td>
          <td>МДК 10.02<br>Типцова 404<br>
          ——————————<br>
          Осн. Философии<br>Сергеев 205</td>
          <td>МДК 12.01<br>
              Таланов</td>
          <td>МДК 05.02<br>
          Иванова 301</td>
          <td>МДК 12.01<br>
          Таланов</td>
        </tr>
        <tr>
          <td>4</td>
          <td> </td>
          <td> </td>
          <td>МДК 06.01<br>
          Королёва 406</td>
          <td> </td>
          <td> </td>
          <td> </td>
        </tr>

        </table>

        <a id="bras" class="sliding-button">back</a>
    </div>
    <div id = ras2>
        <table>
            <tr>
                <th>№</th>
                <th>Основное</th>
                <th>Суббота</th>
            </tr>
            <tr>
                <td>1</td>
                <td>8:00 8:45<br>
                    8:50 9:35 </td>
                <td>8:00 9:00</td>
              </tr>
              <tr>
                <td>2</td>
                <td>9:45 10:30 <br>
                    10:35 11:20 </td>
                <td>9:10 10:10</td>
              </tr>
              <tr>
                <td>3</td>
                <td>11:40 12:25 <br>
                    12:30 13:15</td>
                <td>10:20 11:20 <br>1</td>
              </tr>
        </table>
        <a id="bras1" class="sliding-button">back</a>
        <div id="schedule"></div>
    </div>
    
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <script>
        let zwon = document.getElementById("zwon");
        let ras = document.getElementById("ras");
        let tg=window.Telegram.WebApp;
        tg.expand();
        if ('serviceWorker' in navigator) {
            navigator.serviceWorker.register('/sw.js')
            .then(function(registration) {
                console.log('Service Worker зарегистрирован с успешно:', registration);
            })
            .catch(function(error) {
                console.log('Ошибка при регистрации Service Worker:', error);
            });
        }

        zwon.addEventListener("click", () => {
            document.getElementById("weekType").style.display="none";
            document.getElementById("main").style.display ="none";
            document.getElementById("ras2").style.display ="block";
            document.getElementById("schedule").style.display="block";
        })
        let bras1 = document.getElementById("bras1");
        bras1.addEventListener("click", () => {
            document.getElementById("weekType").style.display="block";
            document.getElementById("main").style.display ="block";
            document.getElementById("ras2").style.display ="none";
            document.getElementById("schedule").style.display="none";

        });
        ras.addEventListener("click", () => {
            document.getElementById("weekType").style.display="none";
            document.getElementById("main").style.display ="none";
            document.getElementById("ras1").style.display ="block";
        });
        let bras = document.getElementById("bras");
        bras.addEventListener("click", () => {
            document.getElementById("weekType").style.display="block";
            document.getElementById("main").style.display ="block";
            document.getElementById("ras1").style.display ="none";

        });
        // Получаем текущую дату
        var currentDate = new Date();

        // Получаем номер недели в году
        var weekNumber = getWeekNumber(currentDate);

        // Определяем тип недели (числитель или знаменатель)
        var weekType = weekNumber % 2 === 0 ? "Знаменатель(это с низу)" : "Числитель(это с верху)";

        // Выводим тип недели на страницу
        document.getElementById("weekType").innerHTML = "Сейчас " + weekType + " неделя";

        // Функция для получения номера недели в году
        function getWeekNumber(date) {
            var d = new Date(date);
            d.setHours(0, 0, 0, 0);
            d.setDate(d.getDate() + 4 - (d.getDay() || 7));
            var yearStart = new Date(d.getFullYear(), 0, 1);
            var weekNumber = Math.ceil(((d - yearStart) / 86400000 + 1) / 7);
            return weekNumber;
        }
        //pull to refresh
        function handlePullToRefresh() {
            // Очистить текущий кеш PWA
            caches.delete('my-cache').then(function() {
                // Открыть новый кеш
                caches.open('my-cache').then(function(cache) {
                // Добавить новые ресурсы в кеш
                cache.addAll([
                    '/',
                    '/index.html',
                    '/style.css',
                    '/icon.png'
                    // Добавьте сюда все новые ресурсы
                ]).then(function() {
                    // После обновления кеша, перезагрузите страницу
                    location.reload();
                });
                });
            });
        }
        document.body.addEventListener('touchstart', handleTouchStart, false);
        document.body.addEventListener('touchmove', handleTouchMove, false);

        var startY;
        var refreshIndicator;

        function handleTouchStart(event) {
        startY = event.touches[0].clientY;
        }

        function handleTouchMove(event) {
          if (event.touches[0].clientY > startY + 50) {
            // Если пользователь потянул вниз, то обновляем страницу
            location.reload();
            showRefreshIndicator();
            handlePullToRefresh();
          }
        }

        function showRefreshIndicator() {
        if (!refreshIndicator) {
            // Создаем индикатор обновления, если он еще не создан
            refreshIndicator = document.createElement('div');
            refreshIndicator.classList.add('refresh-indicator');
            refreshIndicator.innerText = '⇣'; // Любой текст или иконку для индикатора
            document.body.appendChild(refreshIndicator);
        }

        // Показываем индикатор обновления
        refreshIndicator.style.display = 'block';
        refreshIndicator.style.animation = 'spin 1s linear infinite'; // Запускаем анимацию

        setTimeout(function () {
            hideRefreshIndicator();
        }, 2000); // Скрываем индикатор через 2 секунды (вы можете настроить время по своему усмотрению)
        }

        function hideRefreshIndicator() {
        if (refreshIndicator) {
            // Скрываем индикатор обновления
            refreshIndicator.style.display = 'none';
        }
        }
        // Задаем расписание звонков для понедельника - пятницы
        const weekdaySchedule = [
        { начало: '8:00', конец: '9:35' },
        { начало: '9:45', конец: '11:20' },
        { начало: '11:40', конец: '13:15' }
        // Добавьте остальные пары для понедельника - пятницы
        ];

        // Задаем расписание звонков для субботы
        const saturdaySchedule = [
        { начало: '8:00', конец: '9:00' },
        { начало: '9:10', конец: '10:10' },
        { начало: '10:20', конец: '11:20' }
        // Добавьте остальные пары для субботы
        ];

        // Функция для получения текущего дня недели
        function getCurrentDayOfWeek() {
        const daysOfWeek = ['воскресенье', 'понедельник', 'вторник', 'среда', 'четверг', 'пятница', 'суббота'];
        const currentDate = new Date();
        return daysOfWeek[currentDate.getDay()];
        }

        // Функция для вычисления оставшегося времени до пары или до конца пары
        function calculateTimeUntilNextClass() {
        const currentDayOfWeek = getCurrentDayOfWeek();
        const currentTime = new Date();
        let schedule;

        if (currentDayOfWeek === 'суббота') {
            schedule = saturdaySchedule;
        } else if (currentDayOfWeek !== 'воскресенье') {
            schedule = weekdaySchedule;
        } else {
            return 'Сегодня выходной.';
        }

        for (const classTime of schedule) {
            const classStart = new Date();
            const classEnd = new Date();

            const [startHour, startMinute] = classTime.начало.split(':');
            const [endHour, endMinute] = classTime.конец.split(':');

            classStart.setHours(parseInt(startHour), parseInt(startMinute), 0, 0);
            classEnd.setHours(parseInt(endHour), parseInt(endMinute), 0, 0);

            if (currentTime >= classStart && currentTime < classEnd) {
            // Пара идет, вычисляем оставшееся время до конца пары
            const timeRemaining = new Date(classEnd - currentTime);
            const minutes = timeRemaining.getMinutes();
            const seconds = timeRemaining.getSeconds();
            return `До конца пары осталось ${minutes}:${seconds < 10 ? '0' : ''}${seconds} минут.`;
            } else if (currentTime < classStart) {
            // Пара еще не началась, вычисляем оставшееся время до начала пары
            const timeRemaining = new Date(classStart - currentTime);
            const minutes = timeRemaining.getMinutes();
            const seconds = timeRemaining.getSeconds();
            return `До начала пары осталось ${minutes}:${seconds < 10 ? '0' : ''}${seconds} минут.`;
            }
        }

        return 'На сегодня больше пар нет.';
        }

        // Отображаем оставшееся время до пары или до конца пары на странице
        const scheduleElement = document.getElementById('schedule');
        scheduleElement.textContent = calculateTimeUntilNextClass();

        // Обновляем информацию каждую секунду
        setInterval(function () {
        scheduleElement.textContent = calculateTimeUntilNextClass();
        }, 1000); // Обновляем каждую секунду

    </script>

</body>
</html>
